<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-66SZLJBHF6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-66SZLJBHF6');
</script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="{{ url_for('static', filename='society_logo.png') }}" type="image/png">
  <title>Staff Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .floating-box {
      transform: translateY(100%);
      opacity: 0;
      transition: transform 0.4s ease, opacity 0.4s ease;
    }
    .floating-box.show {
      transform: translateY(0);
      opacity: 1;
    }
    /* Highlight active sidebar button */
    .active-nav, .nav-button.active-nav {
      background-color: #2563eb !important; /* tailwind blue-600 */
      color: #fff !important;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(37,99,235,0.08);
    }
  </style>
  <!-- Provide runtime config for external JS -->
  <script>
    window.STAFF_DASHBOARD_CONFIG = {
      loginUrl: "{{ url_for('auth.login') }}"
    };
  </script>
</head>
<body class="bg-gray-50">
  <!-- Header - Updated to match landing page style -->
  <header class="w-full bg-white shadow-lg">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <!-- Logo -->
        <img src="{{ url_for('static', filename='society_logo.png') }}" alt="Logo" class="w-12 h-12 rounded-full border border-blue-200" />
        <span class="text-2xl font-bold text-blue-700">KSTHST CO-OP SOCIETY </span>
      </div>
      <div class="flex items-center space-x-4">
        {%- set staff_display = session.get('staff_name') or session.get('name') or session.get('email') -%}
        <span class="text-gray-700">Welcome, {{ staff_display or 'Staff' }}</span>
        <a href="{{ url_for('auth.logout') }}" id="logoutBtn" class="bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200 transition">Logout</a>
      </div>
    </div>
  </header>

  <div class="flex min-h-screen bg-gray-50">
    <!-- Sidebar - Updated style -->
    <aside class="w-64 bg-white shadow-lg p-6 space-y-4">
      <h2 class="font-bold text-xl text-blue-700 mb-6">Staff Dashboard</h2>
      <nav class="space-y-3">
        <button type="button" id="homeBtn" class="w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition">🏠 Home</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="applyLoan">📝 Apply Loan</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="accountInfoIframe">� Customer Details</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="loanInfoSearch" id="loanInfoSearchBtn">� Loan Info Search</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="addUser">➕ Add User</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="checkExpense">💸 Add Expense</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="depositWithdraw">🏦 Deposit/Withdraw</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="loanRepayment">💰 Loan Repayment</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="queriesSection">📬 Queries</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="recentTransactionsStaff">🕒 Recent Transactions</button>
        <button id="getTransactionBtn" class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all">🔎 Get Transaction</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="unblockAccountSection">🔓 Unblock Account</button>
        <button class="nav-button w-full text-left px-4 py-2 rounded-lg bg-blue-100 text-blue-700 hover:bg-blue-200 transition-all" data-target="fixedDepositSection">💹 Fixed Deposit</button>
      </nav>
    </aside>

    <!-- Main content area - Updated style -->
    <main class="flex-1 p-8 space-y-6">
      <!-- NEW: Loan Info Search Section -->
      <section id="loanInfoSearch" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <h2 class="text-2xl font-bold text-purple-700 mb-4">Loan Info Search</h2>
        <form id="loanInfoSearchForm" class="flex flex-col gap-4 mb-4">
          <input type="text" id="loanInfoSearchInput" class="border px-4 py-2 rounded" placeholder="Enter Loan ID" />
          <button type="submit" class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700">Search</button>
        </form>
        <div id="loanInfoSearchResult" class="mt-4"></div>
      </section>      
      
      <!-- DASHBOARD SUMMARY SECTION -->
      <section id="dashboardSummary" class="dynamic-section bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold text-blue-700 mb-6">Dashboard Overview</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="flex items-center bg-blue-100 rounded-lg p-6 shadow">
            <div class="bg-blue-500 text-white rounded-full p-4 mr-4">
              <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M17 20h5v-2a4 4 0 00-3-3.87M9 20H4v-2a4 4 0 013-3.87M12 12a4 4 0 100-8 4 4 0 000 8zm0 0v4m0 0v4m0-4h4m-4 0H8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <div class="text-2xl font-bold" id="totalCustomers">0</div>
              <div class="text-gray-700">Total Customers</div>
            </div>
          </div>
          <div class="flex items-center bg-green-100 rounded-lg p-6 shadow">
            <div class="bg-green-500 text-white rounded-full p-4 mr-4">
              <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M9 17v-6a2 2 0 012-2h2a2 2 0 012 2v6m-6 0h6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <div class="text-2xl font-bold" id="activeLoans">0</div>
              <div class="text-gray-700">Active Loans</div>
            </div>
          </div>
          <div class="flex items-center bg-yellow-100 rounded-lg p-6 shadow">
            <div class="bg-yellow-500 text-white rounded-full p-4 mr-4">
              <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 0V4m0 16v-4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div>
              <div class="text-2xl font-bold" id="totalAmount">₹0</div>
              <div class="text-gray-700">Total Balance</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Apply Loan Section -->
      <section id="applyLoan" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <div class="loader hidden text-center text-blue-600">Loading...</div>
        <div class="content space-y-8" id="applyLoanContent">
          <h2 class="text-xl font-bold text-blue-700 mb-4">Apply for Loan</h2>
          <form id="loanStepForm" class="w-full space-y-6 bg-white p-6 rounded-xl shadow">
            <!-- Step 1: Select Loan Type -->
            <div id="step1" class="space-y-4">
              <label class="block font-semibold mb-2">Select Loan Type:</label>
              <div class="flex gap-6">
                <label class="flex items-center gap-2">
                  <input type="radio" name="loanType" value="normal" class="form-radio" required>
                  Normal Loan
                </label>
                <label class="flex items-center gap-2">
                  <input type="radio" name="loanType" value="emergency" class="form-radio" required>
                  Emergency Loan
                </label>
              </div>
              <button type="button" id="toStep2Btn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded shadow">Next</button>
            </div>
            <!-- Step 2: Enter Account Number -->
            <div id="step2" class="space-y-4 hidden">
              <label class="block font-semibold mb-2">Enter Account Number:</label>
              <input type="text" id="loanAccountNumber" name="accountNumber" class="w-full px-4 py-2 border rounded" required>
              <button type="button" id="fetchAccountBtn" class="px-4 py-2 bg-blue-500 text-white rounded shadow">Fetch Details</button>
              <div id="accountFetchMsg" class="text-sm mt-2"></div>
            </div>
            <!-- Step 3: Preloaded and Manual Fields -->
            <div id="step3" class="space-y-4 hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block font-medium">Name</label>
                  <input type="text" id="loanName" name="name" class="w-full px-4 py-2 border rounded bg-gray-100" readonly>
                </div>
                <div>
                  <label class="block font-medium">Account Number</label>
                  <input type="text" id="loanAccount" name="account" class="w-full px-4 py-2 border rounded bg-gray-100" readonly>
                </div>
                <div>
                  <label class="block font-medium">Share ID </label>
                  <input type="text" id="loanKGID" name="kgid" class="w-full px-4 py-2 border rounded bg-gray-100" readonly>
                </div>
                <div>
                  <label class="block font-medium">Loan Amount</label>
                  <input type="number" id="loanAmount" name="loanAmount" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div>
                  <label class="block font-medium">Rate of Interest (%)</label>
                  <input type="number" id="loanInterest" name="interestRate" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div>
                  <label class="block font-medium">Loan Tenure (months)</label>
                  <input type="number" id="loanTenure" name="loanTenure" class="w-full px-4 py-2 border rounded" required>
                </div>
                <div class="md:col-span-2">
                  <label class="block font-medium">Purpose of Loan</label>
                  <input type="text" id="loanPurpose" name="loanPurpose" class="w-full px-4 py-2 border rounded" required>
                </div>
              </div>
              <!-- Sureties Section -->
              <div class="mt-6">
                <label class="block font-semibold mb-2">Add Sureties (Both Required):</label>
                <div class="text-xs text-red-600 mb-2">You must add two eligible sureties before submitting.</div>
                <div id="suretiesContainer" class="space-y-4">
                  <!-- Surety 1 -->
                  <div class="bg-gray-50 p-4 rounded-xl shadow mb-2" id="surety1Box">
                    <div class="flex gap-2 mb-2">
                      <input type="text" id="surety1KGID" placeholder="Enter Customer ID" class="px-4 py-2 border rounded flex-1" required>
                      <button type="button" id="checkSurety1Btn" class="bg-blue-500 text-white px-3 py-1 rounded">Check</button>
                      <button type="button" id="removeSurety1Btn" class="bg-red-500 text-white px-3 py-1 rounded hidden">Remove</button>
                    </div>
                    <span id="surety1Msg" class="text-sm mb-2 block"></span>
                    <div id="surety1Fields" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                  </div>
                  <!-- Surety 2 -->
                  <div class="bg-gray-50 p-4 rounded-xl shadow" id="surety2Box">
                    <div class="flex gap-2 mb-2">
                      <input type="text" id="surety2KGID" placeholder="Enter Customer ID" class="px-4 py-2 border rounded flex-1" required>
                      <button type="button" id="checkSurety2Btn" class="bg-blue-500 text-white px-3 py-1 rounded">Check</button>
                      <button type="button" id="removeSurety2Btn" class="bg-red-500 text-white px-3 py-1 rounded hidden">Remove</button>
                    </div>
                    <span id="surety2Msg" class="text-sm mb-2 block"></span>
                    <div id="surety2Fields" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
                  </div>
                </div>
              </div>
              <!-- Terms and Conditions -->
              <div class="mt-6">
                <label class="flex items-start gap-2">
                  <input type="checkbox" id="termsCheckbox" class="mt-1" required>
                  <span>
                    We have agreed to be surety for the loan taken by the said person. We are members of the association, and if he defaults, we have given our consent to the wage payment officers to deduct 50% of our salary or share money to repay the loan.
                  </span>
                </label>
              </div>
              <!-- Error Message -->
              <div id="loanFormError" class="text-red-600 font-semibold mb-2"></div>
              <!-- Apply Button -->
              <button type="submit" id="applyLoanBtn" class="mt-4 px-6 py-2 bg-blue-500 text-white rounded shadow w-full" disabled>Apply</button>
            </div>
          </form>
          <!-- Success Popup -->
          <div id="loanSuccessPopup" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-8 rounded-xl shadow-xl text-center">
              <div class="text-green-600 text-3xl mb-4">✔</div>
              <div class="text-lg font-bold mb-2">Loan Application Submitted Successfully!</div>
              <button id="closeLoanSuccess" class="mt-4 px-6 py-2 bg-blue-500 text-white rounded shadow">Close</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Account Info Section - Now as iframe -->
      <section id="accountInfoIframe" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <iframe src="{{ url_for('staff.staff_customer_details') }}" class="w-full min-h-[900px] border-0 rounded-xl shadow" title="Customer Details"></iframe>
      </section>

      <!-- Add User Section -->
      <section id="addUser" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <div class="loader hidden text-center text-blue-600">Loading...</div>
        <div class="content">
          <h2 class="text-xl font-bold text-blue-700 mb-4">Add New User</h2>
          <div id="addUserMsg" class="mb-4 text-center hidden"></div>
          <form id="addUserForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Full Name -->
              <div>
                <label class="block text-sm font-medium mb-1">Full Name</label>
                <input type="text" name="name" placeholder="Full Name" class="border p-2 rounded w-full" required />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Share ID<span class="text-xs text-gray-500">(Optional)</span></label>
                <input type="text" name="kgid" placeholder="KGID" class="border p-2 rounded w-full" />
              </div>
              <!-- Phone & Email Row -->
              <div>
                <label class="block text-sm font-medium mb-1">Phone Number</label>
                <input 
    type="text" 
    name="phone" 
    required 
    pattern="[0-9]{10}" 
    maxlength="10"
    placeholder="Enter 10-digit phone number"
    class="border p-2 rounded w-full"
    title="Enter a valid 10-digit phone number"
    oninput="this.value = this.value.replace(/[^0-9]/g, '')"
  />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Email</label>
                <div class="flex gap-2">
                  <input type="email" name="email" id="emailInput" placeholder="Email" class="border p-2 rounded w-full" required />
                  <button type="button" id="verifyEmailBtn" class="bg-blue-500 text-white px-3 rounded hover:bg-blue-800 flex items-center gap-2">
                    <span id="verifyEmailBtnText">Get otp</span>
                    <span id="verifyEmailBtnSpinner" class="hidden">
                      <svg class="animate-spin h-5 w-5 text-white" viewBox="0 0 24 24" fill="none">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor"
                          d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                      </svg>
                    </span>
                  </button>
                </div>
              </div>
              <!-- OTP Input -->
              <div id="otpContainer" class="col-span-1 md:col-span-2 hidden">
                <label class="block text-sm font-medium mb-1">Enter OTP</label>
                <input type="text" id="otpInput" name="otp" placeholder="Enter OTP" class="border p-2 rounded w-full" />
              </div>
              <!-- More User Details -->
              <div>
                <label class="block text-sm font-medium mb-1">Father's Name</label>
                <input type="text" name="father_name" placeholder="Father's Name" class="border p-2 rounded w-full" required />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Salary</label>
                <input type="text" name="salary" placeholder="Salary" class="border p-2 rounded w-full" required />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Organization Name</label>
                <input type="text" name="organization_name" placeholder="Organization Name" class="border p-2 rounded w-full" required />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Aadhar Number</label>
                 <input 
    type="text" 
    name="aadhar_no" 
    required 
    maxlength="14" 
    placeholder="1234 5678 9012"
    class="border p-2 rounded w-full"
    title="Enter a valid 12-digit Aadhar number"
    oninput="
      // Remove all non-digits
      this.value = this.value.replace(/[^0-9]/g, '');
      // Insert space after every 4 digits
      this.value = this.value.replace(/(\d{4})(?=\d)/g, '$1 ');
    "
    pattern="^[0-9]{4}\s[0-9]{4}\s[0-9]{4}$"
  /> 
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">PAN Number</label>
                <label class="block text-sm font-medium mb-1">PAN Number</label>
  <input 
    type="text" 
    name="pan_no" 
    required 
    maxlength="10"
    placeholder="ABCDE1234F"
    class="border p-2 rounded w-full uppercase"
    pattern="^[A-Z]{5}[0-9]{4}[A-Z]{1}$"
    title="Enter a valid PAN Number (e.g., ABCDE1234F)"
    oninput="this.value = this.value.toUpperCase()"
  />
              </div>
              <!-- Address -->
              <div class="col-span-1 md:col-span-2">
                <label class="block text-sm font-medium mb-1">Address</label>
                <textarea name="address" placeholder="Address" class="border p-2 rounded w-full" required></textarea>
              </div>
              <!-- Photo Upload -->
              <div>
                <label class="block text-sm font-medium mb-1">Upload Photo <span class="text-xs text-gray-500">(Image must be below 50KB)</span></label>
                <input type="file" name="photo" class="border p-2 rounded w-full" accept="image/*" required />
              </div>
              <!-- Signature Upload -->
              <div>
                <label class="block text-sm font-medium mb-1">Upload Signature <span class="text-xs text-gray-500">(Image must be below 50KB)</span></label>
                <input type="file" name="signature" class="border p-2 rounded w-full" accept="image/*" required />
              </div>
            </div>
            <!-- Warning Message -->
            <p id="verifyWarning" class="text-red-500 mt-2 hidden col-span-1 md:col-span-2">⚠ Please verify your email before proceeding.</p>
            <button id="addUserBtn" type="submit" class="mt-4 px-4 py-2 bg-green-500 text-white rounded flex items-center gap-2">
              <span id="addUserBtnText">Add User</span>
              <span id="addUserBtnSpinner" class="hidden">
                <svg class="animate-spin h-5 w-5 text-white" viewBox="0 0 24 24" fill="none">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
              </span>
            </button>
          </form>
        </div>
      </section>

      <!-- Check Expense Section -->
      <section id="checkExpense" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <div class="loader hidden text-center text-blue-600">Loading...</div>
        <!-- Header with Download Button -->
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-blue-700">Add Expense</h2>
          <button id="downloadReportBtn" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
            Download Report
          </button>
        </div>
        <div class="content space-y-4">
          <form id="addExpenseForm" class="space-y-4">
            <input type="text" id="expenseTransactionId" placeholder="Transaction ID (Optional)" class="w-full border p-2 rounded" />
            <input type="text" id="expenseName" placeholder="Expense Name *" class="w-full border p-2 rounded" required />
            <input type="number" id="expenseAmount" placeholder="Amount *" class="w-full border p-2 rounded" step="0.01" required />
            <input type="date" id="expenseDate" class="w-full border p-2 rounded" required />
            <textarea id="expenseDescription" placeholder="Description (Optional)" class="w-full border p-2 rounded"></textarea>
            <button type="submit" id="addExpenseBtn" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 w-full flex items-center justify-center gap-2">
              <span id="addExpenseBtnText">Add Expense</span>
              <svg id="addExpenseSpinner" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
              </svg>
            </button>
          </form>
        </div>
      </section>

      <!-- Deposit/Withdraw Section -->
      <section id="depositWithdraw" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <div class="loader hidden text-center text-blue-600">Loading...</div>
        <div class="content space-y-6">
          <h2 class="text-xl font-bold text-blue-700 mb-4">Deposit / Withdraw</h2>
          
          <!-- Toggle Buttons -->
          <div class="flex gap-2 mb-4">
            <button id="showDepositBtn" class="toggle-btn px-4 py-2 rounded shadow bg-gray-300">Deposit</button>
            <button id="showWithdrawBtn" class="toggle-btn px-4 py-2 rounded shadow bg-gray-300">Withdraw</button>
          </div>

          <!-- Deposit Form -->
          <div id="depositForm" class="bg-white p-6 rounded-xl shadow hidden">
            <h3 class="text-lg font-semibold mb-4 text-green-700 text-center">Deposit</h3>
            <input type="text" placeholder="Customer ID" class="w-full px-4 py-2 border rounded mb-3" id="depositCustomerId" />
            <input type="number" placeholder="Amount" class="w-full px-4 py-2 border rounded mb-3" id="depositAmount" />
            <input type="date" class="w-full px-4 py-2 border rounded mb-3" id="depositDate" />
            <div class="flex gap-2 mb-3">
              <input type="number" placeholder="from Account Number" class="w-1/2 px-4 py-2 border rounded" id="depositFromAccount" />
              <input type="text" placeholder="Bank Name" class="w-1/2 px-4 py-2 border rounded" id="depositFromBank" />
            </div>
            <div class="flex gap-2 mb-3">
              <input type="number" placeholder="To Account Number" class="w-1/2 px-4 py-2 border rounded" id="depositToAccount" />
              <input type="text" placeholder="Bank Name" class="w-1/2 px-4 py-2 border rounded" id="depositToBank" />
            </div>
            <input type="text" placeholder="Transaction ID" class="w-full px-4 py-2 border rounded mb-3" id="depositTxnId" />
            <input type="text" placeholder="Remarks" class="w-full px-4 py-2 border rounded mb-3" id="depositRemarks" />
            <button id="depositBtn" class="bg-green-500 text-white px-6 py-2 rounded w-full shadow hover:bg-green-600 transition">Deposit</button>
          </div>

          <!-- Withdraw Form -->
          <div id="withdrawForm" class="bg-white p-6 rounded-xl shadow hidden">
            <h3 class="text-lg font-semibold mb-4 text-red-700 text-center">Withdraw</h3>
            <input type="text" placeholder="Customer ID" class="w-full px-4 py-2 border rounded mb-3" id="withdrawCustomerId" />
            <input type="number" placeholder="Amount" class="w-full px-4 py-2 border rounded mb-3" id="withdrawAmount" />
            <div class="flex gap-2 mb-3">
              <input type="number" placeholder="from Account Number" class="w-1/2 px-4 py-2 border rounded" id="withdrawFromAccount" />
              <input type="text" placeholder="Bank Name" class="w-1/2 px-4 py-2 border rounded" id="withdrawFromBank" />
            </div>
            <div class="flex gap-2 mb-3">
              <input type="number" placeholder="To Account Number" class="w-1/2 px-4 py-2 border rounded" id="withdrawToAccount" />
              <input type="text" placeholder="Bank Name" class="w-1/2 px-4 py-2 border rounded" id="withdrawToBank" />
            </div>
            <input type="date" class="w-full px-4 py-2 border rounded mb-3" id="withdrawDate" />
            <input type="text" placeholder="Transaction ID" class="w-full px-4 py-2 border rounded mb-3" id="withdrawTxnId" />
            <input type="text" placeholder="Remarks" class="w-full px-4 py-2 border rounded mb-3" id="withdrawRemarks" />
            <button id="withdrawBtn" class="bg-red-500 text-white px-6 py-2 rounded w-full shadow hover:bg-red-600 transition">Withdraw</button>
          </div>
        </div>
      </section>

      <!-- Loan Repayment Section: Now loads loan_repayment.html in an iframe -->
      <section id="loanRepayment" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <iframe src="{{ url_for('finance.loan_repayment_page') }}" class="w-full min-h-[900px] border-0 rounded-xl shadow" title="Loan Repayment"></iframe>
      </section>

      <!-- Recent Transactions Section -->
      <section id="recentTransactionsStaff" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <div class="loader hidden text-center text-blue-600">Loading...</div>
        <div class="content space-y-4">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-blue-700">Recent Transactions</h2>
            <div class="flex items-center gap-2">
              <label for="rtYearStaff" class="text-sm text-gray-600">Year</label>
              <select id="rtYearStaff" class="px-3 py-1 border rounded-lg"></select>
              <label for="rtMonthStaff" class="text-sm text-gray-600">Month</label>
              <select id="rtMonthStaff" class="px-3 py-1 border rounded-lg"></select>
              <label for="rtDayStaff" class="text-sm text-gray-600">Day</label>
              <select id="rtDayStaff" class="px-3 py-1 border rounded-lg"></select>
              <button id="rtFilterBtnStaff" class="px-3 py-1 rounded-lg bg-blue-600 text-white">Filter</button>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Details</th>
                  <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Ref</th>
                </tr>
              </thead>
              <tbody id="rtTableBodyStaff" class="bg-white divide-y divide-gray-200">
                <tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">No data</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Queries Section -->
      <section id="queriesSection" class="dynamic-section hidden bg-white p-6 rounded shadow">
        <h2 class="text-xl font-bold text-blue-700 mb-4">Queries</h2>
        <div id="queriesMsg" class="mb-4"></div>
        <div class="overflow-x-auto">
          <table id="queriesTable" class="min-w-full table-auto border-collapse">
            <thead>
              <tr class="bg-gray-100 text-left">
                <th class="px-4 py-2">#</th>
                <th class="px-4 py-2">Name</th>
                <th class="px-4 py-2">Email</th>
                <th class="px-4 py-2">Phone</th>
                <th class="px-4 py-2">KGID / Customer ID</th>
                <th class="px-4 py-2">Description</th>
                <th class="px-4 py-2">Status</th>
                <th class="px-4 py-2">Actions</th>
              </tr>
            </thead>
            <tbody id="queriesTbody">
              <!-- Rows populated by JS -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- Unblock Account Section -->
      <section id="unblockAccountSection" class="dynamic-section hidden bg-white p-6 rounded shadow">
        {% include 'unblock_account.html' %}
      </section>

      <!-- Fixed Deposit Section -->
      <section id="fixedDepositSection" class="dynamic-section hidden bg-white p-6 rounded shadow">
        {% include 'Fix_deposit.html' %}
      </section>
    </main>
  </div>

  <!-- Transaction Modal -->
  <div id="transactionModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-md">
      <h3 class="text-lg font-bold mb-4 text-blue-700">Get Transactions</h3>
      <div id="transInputPanel">
        <label class="block mb-2">STID</label>
        <input type="text" id="transSTID" class="w-full px-4 py-2 border rounded mb-3" placeholder="Enter STID" />
        <button id="fetchTransBtn" class="bg-blue-500 text-white px-4 py-2 rounded shadow">Fetch</button>
        <button id="closeTransModal" class="bg-gray-300 text-gray-700 px-4 py-2 rounded shadow ml-2">Close</button>
      </div>
      <div id="transResult" class="mt-4"></div>
    </div>
  </div>

  <!-- Mail Notification Modal -->
  <div id="mailModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-lg">
      <h3 class="text-lg font-bold mb-4 text-yellow-700">Mail Notifications</h3>
      <div id="mailList" class="space-y-4">
        <!-- Dummy mail notifications for testing -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
          <p class="font-semibold">Subject: Loan Application Approved</p>
          <p>To: user1@domain.com</p>
          <p>Date: 2025-08-19</p>
          <p>Message: Your loan application (ID: 123456) has been approved.</p>
        </div>
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mt-2">
          <p class="font-semibold">Subject: Payment Reminder</p>
          <p>To: user2@domain.com</p>
          <p>Date: 2025-08-18</p>
          <p>Message: Your next loan installment is due on 2025-08-25.</p>
        </div>
      </div>
      <button id="closeMailModal" class="mt-4 px-6 py-2 bg-gray-300 text-gray-700 rounded shadow">Close</button>
    </div>
  </div>

  <!-- Floating Civil Score Button -->
  <button id="civilBtn" class="fixed bottom-20 right-6 bg-green-600 text-white px-5 py-3 rounded-full shadow-lg hover:bg-green-700">
    📊 Civil Score
  </button>

  <!-- Floating Civil Score Box -->
  <div id="civilBox" class="floating-box hidden fixed bottom-36 right-6 w-80 bg-white rounded-xl shadow-2xl p-4 z-50">
    <div class="flex justify-between items-center mb-3">
      <h3 class="text-lg font-bold">Check Civil Score</h3>
      <button id="closeCivil" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
    </div>
    <!-- Add id for input and result display -->
    <input id="civilInput" class="w-full mb-3 px-4 py-2 border rounded" placeholder="Enter Customer ID or Share ID" />
    <button id="checkCivil" class="bg-green-600 text-white px-6 py-2 rounded w-full hover:bg-green-700">Check Now</button>
    <div id="civilResult" class="mt-3 text-center text-blue-700"></div>
  </div>
  
  <script src="{{ url_for('static', filename='shared.js') }}"></script>
  <!-- External consolidated dashboard script -->
  <script src="{{ url_for('static', filename='js/staff_dashboard.js') }}"></script>
  <script>
    // Highlight active sidebar button
    document.addEventListener('DOMContentLoaded', function() {
      const navBtns = document.querySelectorAll('.nav-button');
      navBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          navBtns.forEach(b => b.classList.remove('active-nav'));
          btn.classList.add('active-nav');
        });
      });
      // Optionally, highlight Home on load
      const homeBtn = document.getElementById('homeBtn');
      if (homeBtn) {
        homeBtn.addEventListener('click', function() {
          navBtns.forEach(b => b.classList.remove('active-nav'));
        });
      }
    });
  </script>
  <!-- Modal for dashboard messages (used by JS) -->
  <div id="dashboardMsgModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-sm text-center">
      <div id="dashboardMsgModalIcon" class="text-4xl mb-2"></div>
      <div id="dashboardMsgModalText" class="mb-4 text-lg"></div>
      <button id="dashboardMsgModalClose" class="px-6 py-2 bg-blue-600 text-white rounded shadow">OK</button>
    </div>
  </div>
</body>
</html>
