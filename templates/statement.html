<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-66SZLJBHF6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-66SZLJBHF6');
</script>
  <meta charset="UTF-8">
  <title>KSTHST Account Statement</title>
  <!-- Use direct external URL for favicon, do NOT use url_for for external URLs -->
  <link rel="icon" href="https://geqletipzwxokceydhmi.supabase.co/storage/v1/object/public/staff-add/society_logo.png" type="image/png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; color: #222; background: #fff; }
    .statement-container { max-width: 1200px; margin: 0 auto; background: #fff; }
    .header-bar {
      background: #fff;               /* white */
      border-bottom: 1px solid #ddd; /* light divider */
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
    }
    .header-bar .branding {
      display: flex;
      align-items: center;
    }
    .branding .title {
      font-size: 1.8rem;
      font-weight: bold;
      color: #2563eb;
      margin-right: 12px;
    }
    .branding img {
      width: 60px; height: 60px;
      object-fit: contain;
      margin-right: 12px;
    }
    .branding .subtitle {
      font-size: 1.2rem;
      font-weight: 600;
      color: #444;
    }
    /* center and enlarge Account Statement */
    .statement-label {
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      font-weight: bold;
      color: #222;
    }
    /* Bordered details section under heading */
    .details-card {
      margin: 12px 32px 16px 32px;
      border: 1px solid #e5e7eb; /* light gray */
      border-radius: 8px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      background: #fff;
    }
    .details-card .info { flex: 1; font-size: 0.95rem; line-height: 1.5; }
    .details-card .info .name { color: #2563eb; font-weight: 700; font-size: 1.05rem; }
    .details-card .info .muted { color: #555; }
    .details-card .info .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px 20px;
      margin-top: 6px;
    }
    .details-card .info .label { color: #6b7280; }
    .details-card .info .value { color: #111827; font-weight: 600; }
    .details-card .photo { display: flex; justify-content: flex-end; min-width: 80px; }
    .details-card .photo img {
      width: 72px; height: 72px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #2563eb;
    }
    @media (max-width: 640px) {
      .details-card { flex-direction: column-reverse; align-items: stretch; padding: 12px; margin: 12px 16px; }
      .details-card .info .row { grid-template-columns: 1fr; }
      .details-card .photo { justify-content: flex-start; margin-bottom: 8px; }
    }
    .details-row {
      background: none;
      border-bottom: 1px solid #eee;
      padding: 8px 32px;  /* reduce top/bottom padding */
      margin-top: -8px;   /* lift upward */
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
    }
    .details-col { min-width: 220px; }
    .details-label { color: #2563eb; font-weight: 600; }
    .statement-table {
      width: 100%;
      border-collapse: collapse;
      margin: 0;
      background: #fff;
    }
    .statement-table th, .statement-table td {
      border: 1px solid #e3eaf2;
      padding: 10px 8px;
      text-align: left;
      font-size: 1rem;
    }
    .statement-table th {
      background: #e3f0ff;
      color: #2563eb;
      font-weight: bold;
      text-align: left;
      border-bottom: 2px solid #b6d4fe;
    }
    .statement-table td {
      background: #fff;
      vertical-align: top;
    }
    .statement-table tr:nth-child(even) td {
      background: #f6faff;
    }
    .deposit { color: #059669; font-weight: 600; }
    .withdrawal { color: #dc2626; font-weight: 600; }
    .type-cell { font-weight: 600; }
    .amount-cell { font-weight: 600; }
    .balance-cell { font-weight: 600; }
    .date-stid-cell { line-height: 1.3; }
    .stid { color: #888; font-size: 0.95em; display: block; }
    .footer-bar {
      text-align: right;
      font-size: 0.95rem;
      color: #888;
      margin: 24px 32px 0 0;
    }
    @media print {
      .statement-container { box-shadow: none !important; }
      .header-bar, .details-row, .footer-bar { padding-left: 0; padding-right: 0; }
    }
    .header-bar { position: relative; } /* ensure absolute children anchor correctly */
    /* details-card is the new responsive section; header-right no longer used */
  </style>
</head>
<body>
  <div class="statement-container">
    <div class="header-bar">
      <div class="branding">
        <div class="title">KSTHST</div>
        <!-- Use direct external URL for logo image -->
        <img src="https://geqletipzwxokceydhmi.supabase.co/storage/v1/object/public/staff-add/society_logo.png" alt="Logo">
        <div class="subtitle">Co-operative Society</div>
      </div>
      <div class="statement-label" style="left:50%;top:50%;transform:translate(-50%,-50%);position:absolute;text-align:center;width:max-content;">
        Account Statement
      </div>
    </div>

    <!-- Details + Photo bordered section under heading -->
    <div class="details-card">
      <div class="info">
        <div class="name">{{ name or '-' }}</div>
        <div class="muted">{{ address or '-' }}</div>
        <div class="muted">{{ org_name or '-' }}</div>
        <div class="row">
          <div><span class="label">KGID:</span> <span class="value">{{ kgid or '-' }}</span></div>
          <div><span class="label">Customer ID:</span> <span class="value">{{ customer_id or '-' }}</span></div>
          <div><span class="label">Email:</span> <span class="value">{{ email or '-' }}</span></div>
          <div><span class="label">Phone:</span> <span class="value">{{ phone or '-' }}</span></div>
          <div style="grid-column: 1 / -1;"><strong>Period:</strong> {{ period_text or '-' }}</div>
        </div>
      </div>
      <div class="photo">
        {% if photo_url %}
        <img src="{{ photo_url }}" alt="User Photo">
        {% endif %}
      </div>
    </div>

    <!-- statement table -->
    <table class="statement-table">
      <thead>
        <tr>
          <th>Date<br><span style="font-weight:400;font-size:0.95em;">STID</span></th>
          <th>Description</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody>
        {% for tr in transactions %}
        <tr>
          <td class="date-stid-cell">
            {{ tr.date.split('T')[0] if tr.date else '-' }}
            <span class="stid">{{ tr.stid or '-' }}</span>
          </td>
          <td>{{ tr.remarks if tr.remarks and tr.remarks != 'null' else '-' }}</td>
          <td class="type-cell">
            {% if tr.type == 'deposit' %}
              <span class="deposit">Deposit</span>
            {% elif tr.type == 'withdraw' %}
              <span class="withdrawal">Withdrawal</span>
            {% else %}
              -
            {% endif %}
          </td>
          <td class="amount-cell {% if tr.type == 'deposit' %}deposit{% elif tr.type == 'withdraw' %}withdrawal{% endif %}">
            {% if tr.amount is not none %}
              ₹{{ '{:,.0f}'.format(tr.amount|float) }}
            {% else %}
              -
            {% endif %}
          </td>
          <td class="balance-cell">
            {% if tr.get('balance_after') is not none %}
              ₹{{ '{:,.0f}'.format(tr.get('balance_after')|float) }}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <!-- Footer -->
    <div class="footer-bar">
      <!-- Optionally add any footer note here -->
    </div>
    {% if error_message %}
      <div class="mt-4 text-center" style="color:#dc2626;font-weight:600;">{{ error_message }}</div>
    {% endif %}
  </div>
</body>
</html>

