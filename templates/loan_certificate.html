<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Certificate - {{ loan.loan_id }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .certificate {
            border: 2px solid #000;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        .certificate-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        .certificate-logo {
            width: 80px;
            height: 80px;
            margin-right: 20px;
        }
        .certificate-title-container {
            flex: 1;
            text-align: center;
        }
        .certificate-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .certificate-subtitle {
            font-size: 18px;
            color: #555;
        }
        .certificate-body {
            margin-bottom: 20px;
        }
        .certificate-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
                <meta charset="UTF-8">
                <link rel="icon" href="{{ url_for('static', filename='society_logo.png') }}" type="image/png">
                <title>Loan Certificate - {{ loan.loan_id }}</title>
    
        }
        .certificate-section {
            margin-bottom: 15px;
        }
        .certificate-section h3 {
            margin-bottom: 5px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 3px;
        }
        .certificate-label {
            font-weight: bold;
            min-width: 200px;
            display: inline-block;
        }
        .certificate-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
        }
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .status-approved {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .print-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        @media print {
            .print-button {
                display: none;
            }
            body {
                padding: 0;
                margin: 0;
                width: 210mm;
                height: 297mm;
                zoom: 0.75;
                /* For browsers that support zoom */
            }
            .certificate {
                border: none;
                box-shadow: none;
                margin: 0;
                width: 100%;
                page-break-inside: avoid;
            }
            @page {
                size: A4;
                margin: 10mm;
            }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">Print Certificate</button>
    
    <div class="certificate">
        <div class="certificate-status status-{{ loan.status }}" style="color: red;">{{ loan.status|upper }}</div>
        
        <div class="certificate-header">
            <img src="https://geqletipzwxokceydhmi.supabase.co/storage/v1/object/public/staff-add/society_logo.png" 
                 alt="Society Logo" class="certificate-logo">
            <div class="certificate-title-container">
                <div class="certificate-title">KSTHST Coof Society</div>
                <div class="certificate-subtitle">Loan Certificate</div>
            </div>
           
        </div>
        
        <div class="certificate-body">
            <div class="certificate-section">
                <h3>Borrower Information</h3>
                <p><span class="certificate-label">Name:</span> {{ member.name or member_name }}</p>
                <p><span class="certificate-label">Customer ID:</span> {{ loan.customer_id }}</p>
                {% if member.photo_url %}
                    <img src="{{ member.photo_url }}" alt="Member Photo" style="width:80px;height:80px;object-fit:cover;border-radius:50%;border:1px solid #aaa;float:right;margin-left:15px;margin-top:-75px;position:relative;">
                {% endif %}
            </div>

           

            <div class="certificate-section">
                <h3>Loan Details</h3>
                <p><span class="certificate-label">Loan ID:</span> {{ loan.loan_id }}</p>
                <p><span class="certificate-label">Loan Type:</span> {{ loan.loan_type|title }}</p>
                <p><span class="certificate-label">Loan Amount:</span> ₹{{ loan.loan_amount|float|round(2) }}</p>
                <p><span class="certificate-label">Interest Rate:</span> {{ loan.interest_rate }}%</p>
                <p><span class="certificate-label">Term:</span> {{ loan.loan_term_months }} months</p>
                <p><span class="certificate-label">Issue Date:</span> 
                    {% if loan.issue_date %}
                        {{ loan.issue_date }}
                    {% elif loan.created_at %}
                        {{ loan.created_at[:10] }}
                    {% else %}
                        —
                    {% endif %}
                      <div class="certificate-section" style="margin-top:30px; display:flex; gap:40px;">
                <div style="flex:1; text-align:right;">
                    <p style="margin-bottom:2px;">_________________________</p>
                    <p style="margin-top:0; font-size: 13px;">Borrower Signature</p>
                </div>
                </p>
            </div>

            <div class="certificate-section">
                
                <h3>Surety Details</h3>
                 <div class="certificate-section" style="margin-bottom:20px;">
                <strong>Terms and Conditions:</strong>
                <p style="margin-top:8px;">
                    We have agreed to be surety for the loan taken by the said person. We are members of the association, and if he defaults, we have given our consent to the wage payment officers to deduct 50% of our salary or share money to repay the loan.
                </p>
            </div>
                {% if loan.sureties %}
                    <div style="display:flex; gap:40px;">
                        {% for surety in loan.sureties %}
                            <div style="flex:1; border:1px solid #ccc; border-radius:8px; padding:12px; margin-bottom:0; min-width:220px;">
                                <span class="certificate-label">Name:</span> {{ surety.surety_name }}<br>
                                <span class="certificate-label">Customer ID:</span> {{ surety.surety_customer_id }}<br>
                                {% if surety.surety_mobile %}
                                    <span class="certificate-label">Mobile:</span> {{ surety.surety_mobile }}<br>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p>No surety details available.</p>
                {% endif %}
            </div>

          
                {% if loan.sureties %}
                    <div style="display: flex; gap: 40px;">
                        {% for surety in loan.sureties %}
                            {% set align = 'left' if loop.index0 == 0 else 'right' %}
                            <div style="flex:1; text-align:{{ align }};">
                                <p style="margin-bottom:2px;">_________________________</p>
                                <p style="margin-top:0; font-size: 13px;">Surety Signature</p>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            {% if loan.staff_name %}
            <div class="certificate-section">
                <h3>Issued By</h3>
                <p><span class="certificate-label">Staff Name:</span> {{ loan.staff_name }}</p>
            </div>
            {% endif %}

            <div class="certificate-section" style="margin-top:30px;">
                <h3>Office Use Only</h3>
                <p>
                    Society customer ID <strong>{{ loan.customer_id }}</strong> on date <strong>
                    {% if loan.issue_date %}
                        {{ loan.issue_date }}
                    {% elif loan.created_at %}
                        {{ loan.created_at[:10] }}
                    {% else %}
                        —
                    {% endif %}
                    </strong> has been sanctioned a loan amount of <strong>₹{{ loan.loan_amount|float|round(2) }}</strong> with interest rate of <strong>{{ loan.interest_rate }}%</strong> by the KSTHST society.
                </p>
            </div>
        </div>
        
        <div class="certificate-footer">
            <div class="signature" style="text-align:center; float:left; width:40%;">
                <p>_________________________</p>
                <p>Secretary Signature</p>
            </div>
            <div class="signature" style="text-align:center; float:right; width:40%;">
                <p>_________________________</p>
                <p>President Signature</p>
            </div>
            <div style="clear:both;"></div>
        </div>
    </div>
    
    <script>
        // Auto-print when opened with ?print=true
        if (window.location.search.includes('print=true')) {
            window.print();
        }
    </script>
</body>
</html>
